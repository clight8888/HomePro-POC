{% extends "base.html" %}

{% block title %}Contractor Dashboard - HomePro{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Welcome Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-tools text-primary me-2" style="font-size: 1.5rem;"></i>
                        <span class="text-primary fw-bold me-2">Contractor</span>
                        <span class="text-dark fw-bold fst-italic">{{ user.first_name }}</span>
                    </div>
                    <p class="text-muted mb-0">Find and bid on home improvement projects in your area</p>
                </div>

            </div>
        </div>
    </div>
    
    <!-- Contractor Management Navigation -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <a href="{{ url_for('contractor_profile') }}" class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                                <i class="fas fa-user-tie fa-2x mb-2"></i>
                                <strong>Manage Profile</strong>
                                <small class="text-muted">Update your professional information</small>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{{ url_for('contractor_availability') }}" class="btn btn-outline-danger w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                                <i class="fas fa-calendar-alt fa-2x mb-2 icon-dark-red"></i>
                                <strong>Availability Calendar</strong>
                                <small class="text-muted">Set your work schedule</small>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{{ url_for('contractor_messages') }}" class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                                <i class="fas fa-comments fa-2x mb-2 icon-green"></i>
                                <strong>Messages</strong>
                                <small class="text-muted">Manage bid conversations</small>
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="{{ url_for('contractor_reviews', contractor_id=contractor_id) }}" class="btn btn-outline-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                                <i class="fas fa-star fa-2x mb-2 icon-dark-yellow"></i>
                                <strong>My Reviews</strong>
                                <small class="text-muted">View customer feedback</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="row mb-4 g-3">
        <div class="col-lg-3 col-md-6">
            <div class="card text-white h-100" onclick="scrollToProjects()" style="cursor: pointer; background-color: #26A69A;">
                <div class="card-body d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h2 class="mb-0 fw-bold">{{ projects|length }}</h2>
                        <p class="mb-0">Available Projects</p>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-project-diagram fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card text-white h-100" onclick="scrollToBids()" style="cursor: pointer; background-color: #1976D2;">
                <div class="card-body d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h2 class="mb-0 fw-bold">{{ bids|length }}</h2>
                        <p class="mb-0">Your Bids</p>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-handshake fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card bg-success text-white h-100" onclick="scrollToBids()" style="cursor: pointer;">
                <div class="card-body d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h2 class="mb-0 fw-bold">{{ bids|selectattr('status', 'equalto', 'Accepted')|list|length }}</h2>
                        <p class="mb-0">Accepted Bids</p>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-check-circle fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card text-white h-100" onclick="scrollToBids()" style="cursor: pointer; background-color: #F9A825;">
                <div class="card-body d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h2 class="mb-0 fw-bold">${{ "%.0f"|format(bids|selectattr('status', 'equalto', 'Accepted')|map(attribute='amount')|sum or 0) }}</h2>
                        <p class="mb-0">Total Earnings</p>
                    </div>
                    <div class="ms-3">
                        <i class="fas fa-dollar-sign fa-2x opacity-75"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Filters Panel -->
    <div class="row mb-2">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body py-2">
                        <form method="GET" action="{{ url_for('dashboard') }}" id="filtersForm">
                            <div class="row g-2">
                                <div class="col-md-3">
                                    <label for="projectTypeFilter" class="form-label fw-semibold small">
                                        <i class="fas fa-tools me-1 text-primary"></i>Project Type
                                    </label>
                                    <select class="form-select form-select-sm" id="projectTypeFilter" name="type">
                                        <option value="">All Types</option>
                                        <option value="Kitchen Renovation" {% if filters.type == 'Kitchen Renovation' %}selected{% endif %}>Kitchen Renovation</option>
                                        <option value="Bathroom Repair" {% if filters.type == 'Bathroom Repair' %}selected{% endif %}>Bathroom Repair</option>
                                        <option value="Plumbing" {% if filters.type == 'Plumbing' %}selected{% endif %}>Plumbing</option>
                                        <option value="Electrical" {% if filters.type == 'Electrical' %}selected{% endif %}>Electrical</option>
                                        <option value="Painting" {% if filters.type == 'Painting' %}selected{% endif %}>Painting</option>
                                        <option value="Flooring" {% if filters.type == 'Flooring' %}selected{% endif %}>Flooring</option>
                                        <option value="Roofing" {% if filters.type == 'Roofing' %}selected{% endif %}>Roofing</option>
                                        <option value="General Repair" {% if filters.type == 'General Repair' %}selected{% endif %}>General Repair</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="budgetFilter" class="form-label fw-semibold small">
                                        <i class="fas fa-dollar-sign me-1 text-success"></i>Budget Range
                                    </label>
                                    <select class="form-select form-select-sm" id="budgetFilter" name="budget">
                                        <option value="">All Budgets</option>
                                        <option value="0-5000" {% if filters.budget == '0-5000' %}selected{% endif %}>$0 - $5,000</option>
                                        <option value="5000-15000" {% if filters.budget == '5000-15000' %}selected{% endif %}>$5,000 - $15,000</option>
                                        <option value="15000-50000" {% if filters.budget == '15000-50000' %}selected{% endif %}>$15,000 - $50,000</option>
                                        <option value="50000+" {% if filters.budget == '50000+' %}selected{% endif %}>$50,000+</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="locationFilter" class="form-label fw-semibold small">
                                        <i class="fas fa-map-marker-alt me-1 text-danger"></i>Location
                                    </label>
                                    <input type="text" class="form-control form-control-sm" id="locationFilter" name="location" 
                                           placeholder="City, State" value="{{ filters.location }}">
                                </div>
                                <div class="col-md-3">
                                    <label for="sortFilter" class="form-label fw-semibold small">
                                        <i class="fas fa-sort me-1 text-info"></i>Sort By
                                    </label>
                                    <select class="form-select form-select-sm" id="sortFilter" name="sort">
                                        <option value="newest" {% if filters.sort == 'newest' %}selected{% endif %}>Newest First</option>
                                        <option value="oldest" {% if filters.sort == 'oldest' %}selected{% endif %}>Oldest First</option>
                                        <option value="budget_high" {% if filters.sort == 'budget_high' %}selected{% endif %}>Highest Budget</option>
                                        <option value="budget_low" {% if filters.sort == 'budget_low' %}selected{% endif %}>Lowest Budget</option>
                                        <option value="bids" {% if filters.sort == 'bids' %}selected{% endif %}>Most Bids</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-12">
                                    <div class="d-flex gap-2 align-items-center">
                                        <button type="submit" class="btn btn-primary btn-sm fs-7 px-2 py-1">
                                            <i class="fas fa-search me-1"></i>Apply Filters
                                        </button>
                                        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-sm fs-7 px-2 py-1">
                                            <i class="fas fa-times me-1"></i>Clear All
                                        </a>
                                        <div class="ms-auto">
                                            <small class="text-muted fs-7">
                                                <i class="fas fa-info-circle me-1"></i>
                                                Showing {{ projects|length }} of {{ pagination.total }} projects
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Projects List -->
    <div class="row" id="projectsSection">
        <div class="col-12">
            {% if projects %}
                <div class="row g-3" id="projectsList">
                    {% for project in projects %}
                    <div class="col-lg-6 project-card" 
                         data-type="{{ project.project_type }}" 
                         data-budget-min="{{ project.budget_min or 0 }}" 
                         data-budget-max="{{ project.budget_max or 999999 }}" 
                         data-location="{{ project.location.lower() }}" 
                         data-created="{{ project.created_at.timestamp() }}">
                        <div class="card h-100 project-card compact-card">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-title mb-0 fw-semibold">{{ project.title }}{% if project.original_file_path %} <i class="fas fa-microphone ms-1 text-primary" title="Audio recording available"></i>{% endif %}</h6>
                                    <span class="badge bg-primary metallic fs-7">{{ project.project_type }}</span>
                                </div>
                                
                                <p class="card-text text-muted small mb-2">{{ project.description|truncate(100) }}</p>
                                
                                <div class="row g-1 mb-2">
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-map-marker-alt me-1 text-danger fs-7"></i>
                                            <small class="fw-semibold">{{ project.location }}</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-dollar-sign me-1 text-success fs-7"></i>
                                            <small class="fw-semibold">
                                                {% if project.budget_min and project.budget_max %}
                                                    ${{ "%.0f"|format(project.budget_min) }}-${{ "%.0f"|format(project.budget_max) }}
                                                {% elif project.budget_max %}
                                                    Up to ${{ "%.0f"|format(project.budget_max) }}
                                                {% else %}
                                                    Negotiable
                                                {% endif %}
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row g-1 mb-2">
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-clock me-1 text-info fs-7"></i>
                                            <small class="fw-semibold">{{ project.timeline or 'Flexible' }}</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-handshake me-1 text-warning fs-7"></i>
                                            <small class="fw-semibold">{{ project.bid_count }} bids</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <small class="text-muted fs-7">
                                        <i class="fas fa-calendar me-1"></i>{{ project.created_at.strftime('%m/%d/%Y') }}
                                    </small>
                                    
                                    {% if project.has_user_bid > 0 %}
                                        <span class="badge bg-success metallic fs-7">
                                            <i class="fas fa-check me-1"></i>Bid Submitted
                                        </span>
                                    {% else %}
                                        <a href="{{ url_for('view_project', project_id=project.id) }}" class="btn btn-primary btn-sm fs-7 px-2 py-1">
                                            <i class="fas fa-eye me-1"></i>View & Bid
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5>No Projects Available</h5>
                        <p class="text-muted mb-0">There are currently no active projects matching your criteria. Check back later for new opportunities.</p>
                    </div>
                </div>
            {% endif %}
            
            <!-- Pagination -->
            {% if pagination.total_pages > 1 %}
            <div class="row mt-3">
                <div class="col-12">
                    <nav aria-label="Projects pagination">
                        <ul class="pagination justify-content-center mb-2">
                            <!-- Previous Page -->
                            {% if pagination.has_prev %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('dashboard', page=pagination.prev_num, type=filters.type, budget=filters.budget, location=filters.location, sort=filters.sort) }}">
                                        <i class="fas fa-chevron-left me-1"></i>Previous
                                    </a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">
                                        <i class="fas fa-chevron-left me-1"></i>Previous
                                    </span>
                                </li>
                            {% endif %}
                            
                            <!-- Page Numbers -->
                            {% set start_page = [pagination.page - 2, 1]|max %}
                            {% set end_page = [pagination.page + 2, pagination.total_pages]|min %}
                            
                            {% if start_page > 1 %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('dashboard', page=1, type=filters.type, budget=filters.budget, location=filters.location, sort=filters.sort) }}">1</a>
                                </li>
                                {% if start_page > 2 %}
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                {% endif %}
                            {% endif %}
                            
                            {% for page_num in range(start_page, end_page + 1) %}
                                {% if page_num == pagination.page %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ page_num }}</span>
                                    </li>
                                {% else %}
                                    <li class="page-item">
                                        <a class="page-link" href="{{ url_for('dashboard', page=page_num, type=filters.type, budget=filters.budget, location=filters.location, sort=filters.sort) }}">{{ page_num }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            {% if end_page < pagination.total_pages %}
                                {% if end_page < pagination.total_pages - 1 %}
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                {% endif %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('dashboard', page=pagination.total_pages, type=filters.type, budget=filters.budget, location=filters.location, sort=filters.sort) }}">{{ pagination.total_pages }}</a>
                                </li>
                            {% endif %}
                            
                            <!-- Next Page -->
                            {% if pagination.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('dashboard', page=pagination.next_num, type=filters.type, budget=filters.budget, location=filters.location, sort=filters.sort) }}">
                                        Next<i class="fas fa-chevron-right ms-1"></i>
                                    </a>
                                </li>
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">
                                        Next<i class="fas fa-chevron-right ms-1"></i>
                                    </span>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- My Bids Section -->
    {% if bids %}
    <div class="row mt-5" id="bidsSection">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-handshake me-2"></i>My Recent Bids</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Project</th>
                                    <th>My Bid</th>
                                    <th>Timeline</th>
                                    <th>Status</th>
                                    <th>Submitted</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for bid in bids[:10] %}
                                <tr>
                                    <td>
                                        <div>
                                            <strong>{{ bid.title }}</strong>
                                            <br>
                                            <small class="text-muted">{{ bid.project_type }}</small>
                                        </div>
                                    </td>
                                    <td>
                                        <strong>${{ "%.0f"|format(bid.amount) }}</strong>
                                    </td>
                                    <td>{{ bid.timeline }}</td>
                                    <td>
                                        <span class="badge {% if bid.status == 'Accepted' %}bg-success{% elif bid.status == 'Rejected' %}bg-danger{% elif bid.status == 'Withdrawn' %}bg-secondary{% elif bid.status == 'Expired' %}bg-warning{% else %}bg-warning{% endif %}">
                                            {{ bid.status }}
                                        </span>
                                    </td>
                                    <td>
                                        <small>{{ bid.created_at.strftime('%m/%d/%Y') }}</small>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('view_project', project_id=bid.project_id) }}" class="btn btn-outline-primary btn-sm me-1">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        {% if bid.status == 'Submitted' %}
                                        <button class="btn btn-outline-warning btn-sm edit-bid-btn me-1" 
                                                data-bid-id="{{ bid.id }}" 
                                                data-bid-amount="{{ bid.amount }}" 
                                                data-bid-timeline="{{ bid.timeline }}" 
                                                data-bid-description="{{ bid.description }}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm withdraw-bid-btn" 
                                                data-bid-id="{{ bid.id }}"
                                                title="Withdraw Bid">
                                            <i class="fas fa-minus-circle"></i>
                                        </button>
                                        {% endif %}
                                        <a href="{{ url_for('bid_history', bid_id=bid.id) }}" class="btn btn-outline-info btn-sm ms-1" title="View History">
                                            <i class="fas fa-history"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Edit Bid Modal -->
<div class="modal fade" id="editBidModal" tabindex="-1" aria-labelledby="editBidModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editBidModalLabel">
                    <i class="fas fa-edit me-2"></i>Edit My Bid
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editBidForm">
                <div class="modal-body">
                    <input type="hidden" id="editBidId" name="bid_id">
                    
                    <div class="mb-3">
                        <label for="editBidAmount" class="form-label">
                            <i class="fas fa-dollar-sign me-1"></i>Bid Amount ($)
                        </label>
                        <input type="number" class="form-control" id="editBidAmount" name="amount" min="1" step="0.01" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editBidTimeline" class="form-label">
                            <i class="fas fa-clock me-1"></i>Timeline
                        </label>
                        <select class="form-select" id="editBidTimeline" name="timeline" required>
                            <option value="">Select timeline</option>
                            <option value="1-2 weeks">1-2 weeks</option>
                            <option value="2-4 weeks">2-4 weeks</option>
                            <option value="1-2 months">1-2 months</option>
                            <option value="2-3 months">2-3 months</option>
                            <option value="3+ months">3+ months</option>
                            <option value="Flexible">Flexible</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="editBidDescription" class="form-label">
                            <i class="fas fa-file-text me-1"></i>Description
                        </label>
                        <textarea class="form-control" id="editBidDescription" name="description" rows="4" placeholder="Describe your approach, materials, and any additional details..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i>Update Bid
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Withdraw Bid Confirmation Modal -->
<div class="modal fade" id="withdrawBidModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title"><i class="fas fa-minus-circle me-2"></i>Withdraw Bid</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <i class="fas fa-minus-circle fa-3x text-warning mb-3"></i>
                    <h6>You're about to withdraw your bid</h6>
                </div>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Once withdrawn, you cannot undo this action. You'll need to submit a new bid if you change your mind.
                </div>
                <div class="mb-3">
                    <label for="withdrawalReason" class="form-label">Reason for withdrawal (optional):</label>
                    <textarea class="form-control" id="withdrawalReason" rows="3" placeholder="Please provide a reason for withdrawing your bid..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" id="confirmWithdrawBtn">
                    <i class="fas fa-minus-circle me-2"></i>Withdraw Bid
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
/* Project Stats Card Styling */
.project-stats-card {
    border: none;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    overflow: hidden;
}

.project-stats-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.project-stats-card .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.stats-icon {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
}

.project-stats-card .card-header h6 {
    color: white;
    font-weight: 600;
    margin: 0;
    font-size: 1.1rem;
}

.stat-item {
    background: rgba(255, 255, 255, 0.8);
    border-radius: 12px;
    padding: 1.25rem;
    text-align: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(5px);
    animation: fadeInUp 0.6s ease forwards;
    opacity: 0;
    transform: translateY(20px);
}

.stat-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    background: rgba(255, 255, 255, 0.95);
}

.stat-icon-wrapper {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 0.75rem;
    color: white;
    font-size: 1.3rem;
    position: relative;
    overflow: hidden;
}

.stat-icon-wrapper.location-icon {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stat-icon-wrapper.budget-icon {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.stat-icon-wrapper.timeline-icon {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.stat-icon-wrapper.bids-icon {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.stat-content {
    text-align: center;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 0.25rem;
    line-height: 1.2;
}

.stat-label {
    font-size: 0.875rem;
    color: #718096;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Animation delays for staggered effect */
.stat-item:nth-child(1) { animation-delay: 0.1s; }
.stat-item:nth-child(2) { animation-delay: 0.2s; }
.stat-item:nth-child(3) { animation-delay: 0.3s; }
.stat-item:nth-child(4) { animation-delay: 0.4s; }

@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Mobile optimizations */
@media (max-width: 768px) {
    .project-stats-card .card-header {
        padding: 0.75rem 1rem;
    }
    
    .stats-icon {
        width: 35px;
        height: 35px;
        font-size: 1rem;
    }
    
    .stat-item {
        padding: 1rem;
        margin-bottom: 0.75rem;
    }
    
    .stat-icon-wrapper {
        width: 45px;
        height: 45px;
        font-size: 1.1rem;
    }
    
    .stat-value {
        font-size: 1.3rem;
    }
    
    .stat-label {
        font-size: 0.8rem;
    }
}

/* Pagination Styling */
.pagination {
    margin-bottom: 0;
}

.pagination .page-link {
    color: #2c3e50;
    border: 1px solid #dee2e6;
    padding: 0.5rem 0.75rem;
    margin: 0 2px;
    border-radius: 6px;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
}

.pagination .page-link:hover {
    color: #ffffff;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    border-color: #2980b9;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
}

.pagination .page-item.active .page-link {
    color: #ffffff;
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    border-color: #2c3e50;
    box-shadow: 0 4px 8px rgba(44, 62, 80, 0.3);
}

.pagination .page-item.disabled .page-link {
    color: #6c757d;
    background-color: #f8f9fa;
    border-color: #dee2e6;
    opacity: 0.6;
}

.pagination .page-link i {
    font-size: 0.875rem;
}

/* Compact Design Styles */
.compact-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.compact-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.fs-7 {
    font-size: 0.75rem !important;
}

.compact-card .card-body {
    min-height: 200px;
}

.compact-card .badge {
    font-size: 0.65rem;
    padding: 0.25em 0.5em;
}

.compact-card .btn-sm {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
}

/* Responsive adjustments for compact design */
@media (max-width: 768px) {
    .compact-card .card-body {
        min-height: auto;
        padding: 0.75rem !important;
    }
    
    .compact-card h6 {
        font-size: 0.9rem;
    }
    
    .compact-card .small {
        font-size: 0.75rem;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
function toggleFilters() {
    const panel = document.getElementById('filtersPanel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

function refreshProjects() {
    location.reload();
}

function editBid(bidId, amount, timeline, description) {
    // Populate the modal with current bid data
    document.getElementById('editBidId').value = bidId;
    document.getElementById('editBidAmount').value = amount;
    document.getElementById('editBidTimeline').value = timeline;
    document.getElementById('editBidDescription').value = description;
    
    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('editBidModal'));
    modal.show();
}

let currentBidToWithdraw = null;

function showWithdrawConfirmation(bidId) {
    currentBidToWithdraw = bidId;
    document.getElementById('withdrawalReason').value = '';
    
    new bootstrap.Modal(document.getElementById('withdrawBidModal')).show();
}

function withdrawBid(bidId) {
    const reason = document.getElementById('withdrawalReason').value;
    
    fetch(`/withdraw_bid/${bidId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            reason: reason
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const modal = bootstrap.Modal.getInstance(document.getElementById('withdrawBidModal'));
            if (modal) modal.hide();
            
            // Show success message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>Bid withdrawn successfully!
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.container').firstChild);
            
            // Refresh the page to show updated bid
            setTimeout(() => {
                location.reload();
            }, 1500);
        } else {
            alert('Error withdrawing bid: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while withdrawing the bid.');
    });
}

// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
    // Categorize project type badges based on their text content
    const projectTypeBadges = document.querySelectorAll('.badge.bg-primary.metallic');
    projectTypeBadges.forEach(badge => {
        const text = badge.textContent.trim().toLowerCase();
        
        if (text.includes('kitchen')) {
            badge.classList.add('category-kitchen');
        } else if (text.includes('bathroom')) {
            badge.classList.add('category-bathroom');
        } else if (text.includes('plumbing')) {
            badge.classList.add('category-plumbing');
        } else if (text.includes('electrical')) {
            badge.classList.add('category-electrical');
        } else if (text.includes('painting')) {
            badge.classList.add('category-painting');
        } else if (text.includes('flooring')) {
            badge.classList.add('category-flooring');
        } else if (text.includes('roofing')) {
            badge.classList.add('category-roofing');
        } else if (text.includes('general')) {
            badge.classList.add('category-general');
        }
    });
    
    const typeFilter = document.getElementById('projectTypeFilter');
    const budgetFilter = document.getElementById('budgetFilter');
    const locationFilter = document.getElementById('locationFilter');
    const sortFilter = document.getElementById('sortFilter');
    
    // Edit bid button event delegation
    document.addEventListener('click', function(e) {
        if (e.target.closest('.edit-bid-btn')) {
            const btn = e.target.closest('.edit-bid-btn');
            const bidId = btn.dataset.bidId;
            const amount = btn.dataset.bidAmount;
            const timeline = btn.dataset.bidTimeline;
            const description = btn.dataset.bidDescription;
            
            editBid(bidId, amount, timeline, description);
        }
        
        if (e.target.closest('.withdraw-bid-btn')) {
            const btn = e.target.closest('.withdraw-bid-btn');
            const bidId = btn.dataset.bidId;
            
            showWithdrawConfirmation(bidId);
        }
    });
    
    // Withdraw bid confirmation button
    const confirmWithdrawBtn = document.getElementById('confirmWithdrawBtn');
    if (confirmWithdrawBtn) {
        confirmWithdrawBtn.addEventListener('click', function() {
            if (currentBidToWithdraw) {
                withdrawBid(currentBidToWithdraw);
            }
        });
    }
    
    // Edit bid form submission
    const editBidForm = document.getElementById('editBidForm');
    if (editBidForm) {
        editBidForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(editBidForm);
            const bidId = formData.get('bid_id');
            
            // Show loading state
            const submitBtn = editBidForm.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Updating...';
            submitBtn.disabled = true;
            
            fetch(`/edit_bid/${bidId}`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('editBidModal'));
                    modal.hide();
                    
                    // Show success message
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-success alert-dismissible fade show';
                    alertDiv.innerHTML = `
                        <i class="fas fa-check-circle me-2"></i>${data.message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.container').firstChild);
                    
                    // Refresh the page to show updated bid
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    // Show error message
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-danger alert-dismissible fade show';
                    alertDiv.innerHTML = `
                        <i class="fas fa-exclamation-circle me-2"></i>${data.message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.querySelector('.modal-body').insertBefore(alertDiv, document.querySelector('.modal-body').firstChild);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger alert-dismissible fade show';
                alertDiv.innerHTML = `
                    <i class="fas fa-exclamation-circle me-2"></i>An error occurred while updating your bid. Please try again.
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                document.querySelector('.modal-body').insertBefore(alertDiv, document.querySelector('.modal-body').firstChild);
            })
            .finally(() => {
                // Restore button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });
    }
    
    // Handle filter form submission
    const filterForm = document.getElementById('filterForm');
    if (filterForm) {
        // Auto-submit form when filters change
        const filterInputs = filterForm.querySelectorAll('select, input');
        filterInputs.forEach(input => {
            input.addEventListener('change', function() {
                filterForm.submit();
            });
        });
        
        // Handle location input with debounce
        const locationInput = document.getElementById('locationFilter');
        if (locationInput) {
            let locationTimeout;
            locationInput.addEventListener('input', function() {
                clearTimeout(locationTimeout);
                locationTimeout = setTimeout(() => {
                    filterForm.submit();
                }, 500); // 500ms debounce
            });
        }
    }
});

// Smooth scroll to projects section
function scrollToProjects() {
    const projectsSection = document.getElementById('projectsSection');
    if (projectsSection) {
        projectsSection.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
        
        // Add a subtle animation effect to the card
        const availableProjectsCard = event.target.closest('.card');
        if (availableProjectsCard) {
            availableProjectsCard.style.transform = 'scale(0.98)';
            setTimeout(() => {
                availableProjectsCard.style.transform = 'scale(1)';
            }, 150);
        }
    }
}

// Smooth scroll to bids section
function scrollToBids() {
    const bidsSection = document.getElementById('bidsSection');
    if (bidsSection) {
        bidsSection.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
        
        // Add a subtle animation effect to the card
        const clickedCard = event.target.closest('.card');
        if (clickedCard) {
            clickedCard.style.transform = 'scale(0.98)';
            setTimeout(() => {
                clickedCard.style.transform = 'scale(1)';
            }, 150);
        }
    }
}
</script>
{% endblock %}